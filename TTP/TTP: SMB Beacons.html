<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.10 (457750)"/><meta name="author" content="jmrobertson@protonmail.com"/><meta name="created" content="2019-05-29 17:22:50 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2019-05-29 21:01:04 +0000"/><title>TTP: SMB Beacons</title></head><body><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Times; font-variant-caps: normal; font-variant-ligatures: normal;">beacons/internal infrastructure:</span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Times; font-variant-caps: normal; font-variant-ligatures: normal;">-don't want to build a campaign that can be taken out easily</span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Times; font-variant-caps: normal; font-variant-ligatures: normal;">-assume some agents will be discovered by red team</span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Times; font-variant-caps: normal; font-variant-ligatures: normal;">-if all hosts are talking to 1 or 2 c2 endpoints, pretty easy to take out entire infra</span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Times; font-variant-caps: normal; font-variant-ligatures: normal;">-SMB Beacons b/t hosts for 2 comms</span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Times; font-variant-caps: normal; font-variant-ligatures: normal;">-&gt;result:</span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Times; font-variant-caps: normal; font-variant-ligatures: normal;">-one compromised machine comm to the internet</span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Times; font-variant-caps: normal; font-variant-ligatures: normal;">-all other machines on on network comm through initial compromised host over smb</span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Times; font-variant-caps: normal; font-variant-ligatures: normal;">-allows: if second systems are detected, might not be able to id c2 domain associated w/ attak</span></div><div><a href="https://www.cobaltstrike.com/help-smb-beacon" style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Times; font-variant-caps: normal; font-variant-ligatures: normal;">https://www.cobaltstrike.com/help-smb-beacon</a></div><div><br/></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Times; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: Times;"><img src="TTP%3A%20SMB%20Beacons.html.resources/E99F892C-AF2F-458B-89A1-1E57ACDD6ADB.png" height="309" width="688"/><br/></span></div><div><span style="color: rgb(0, 0, 0); font-family: Times; --inversion-type-color: simple;"><a href="https://blog.cobaltstrike.com/2013/12/06/stealthy-peer-to-peer-cc-over-smb-pipes/">https://blog.cobaltstrike.com/2013/12/06/stealthy-peer-to-peer-cc-over-smb-pipes/</a></span></div><div><br/></div><div><b>SMB Named Pipes</b></div><div>-named pipe = inter-process communication mechanism on windows</div><ol><li><div>CreateNamedPipe fxn sets up a named pipe, plus set PIPE_ACCESS_DUPLEX flag to make it bidirectional </div></li><li><div>CreateFile fxn connects to named pipe, including remote hosts w/ proper notation</div></li><li><div>ReadFile/WriteFile fans send data from/through named pipes</div></li><li><div>Done through SMB</div></li></ol><div>-needs p445 open</div><div>-delivering beacon peer to host, created in-memory backdoor </div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></body></html>