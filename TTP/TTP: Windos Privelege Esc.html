<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.10 (457750)"/><meta name="author" content="jmrobertson@protonmail.com"/><meta name="created" content="2019-06-03 13:18:58 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2019-06-03 14:35:26 +0000"/><title>TTP: Windos Privelege Esc</title></head><body><div><a href="https://sec-consult.com/en/blog/2019/04/windows-privilege-escalation-an-approach-for-penetration-testers/">https://sec-consult.com/en/blog/2019/04/windows-privilege-escalation-an-approach-for-penetration-testers/</a></div><div><span style="font-weight: bold; font-size: 18px;">Windows Core Components</span></div><div><span style="font-weight: bold; font-size: 18px;">Methods and Techniques</span></div><div><br/></div><div><br/></div><div><b><font style="font-size: 18px;">Windows Core Components</font></b></div><div><i>Windows Desktop vs. Windows Server</i></div><div>WD: prioritizes foreground apps</div><div>WS: supports more memory, uses CPU more efficiently, allows more network connections, configured to prioritize background tasks</div><div><br/></div><div><i>Service packs:</i> </div><div>combine previous patches (sec fixes, performance improvements, support for new types of hardware, backwards compatible </div><div><br/></div><div><i>Kernel:</i></div><div>-set of functions w/ fundamental mechanisms</div><div>-scheduling and sync</div><div>-used by components and low-level hardware architecture</div><div>-written in C, has assy </div><div>-important tasks</div><div>&gt;read/write to memroy</div><div>&gt;comms w/ input and network devices</div><div><br/></div><div><i>Registry </i></div><div>-central component w/ boot/system info, system-wide software settings, security database, pre-user config settings</div><div>-has k:v setup</div><div>-key= container w/ keys and values</div><div>-highest level keys = root keys</div><div><br/></div><div><div><b><i>*Six Root Keys`</i></b></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 290px;"/><col style="width: 364px;"/><col style="width: 381px;"/></colgroup><tbody><tr><td style="background-color: rgb(205, 238, 240); border: 1px solid rgb(137, 215, 220); width: 290px; padding: 8px;"><div><b><font style="color: rgb(0, 0, 0); --inversion-type-color: simple;">Root Key</font></b></div></td><td style="background-color: rgb(205, 238, 240); border: 1px solid rgb(137, 215, 220); width: 364px; padding: 8px;"><div><b><font style="color: rgb(0, 0, 0); --inversion-type-color: simple;">Abbreviation</font></b></div></td><td style="background-color: rgb(205, 238, 240); border: 1px solid rgb(137, 215, 220); width: 381px; padding: 8px;"><div><b><font style="color: rgb(0, 0, 0); --inversion-type-color: simple;">Description</font></b></div></td></tr><tr><td style="width: 290px; padding: 8px; border: 1px solid;"><div>HKEY_CURRENT_USWE</div></td><td style="width: 364px; padding: 8px; border: 1px solid;"><div>HKCU</div></td><td style="width: 381px; padding: 8px; border: 1px solid;"><div>Stores data associated w/ currently logged-on user, mapped to current ylogged user’s key in HKEY_USERS</div></td></tr><tr><td style="width: 290px; padding: 8px; border: 1px solid;"><div>HKEY_USERS</div></td><td style="width: 364px; padding: 8px; border: 1px solid;"><div>HKU</div></td><td style="width: 381px; padding: 8px; border: 1px solid;"><div>Stores info on all accounts on the machine<br/></div></td></tr><tr><td style="width: 290px; padding: 8px; border: 1px solid;"><div>HKEY_CLASSES_ROOT</div></td><td style="width: 364px; padding: 8px; border: 1px solid;"><div>HKCR</div></td><td style="width: 381px; padding: 8px; border: 1px solid;"><div>storage files association and component object model (COM) object registration information</div></td></tr><tr><td style="width: 290px; padding: 8px; border: 1px solid;"><div>HKEY_LOCAL_MACHINE</div></td><td style="width: 364px; padding: 8px; border: 1px solid;"><div>HKLM</div></td><td style="width: 381px; padding: 8px; border: 1px solid;"><div>system-related info and contains most keys</div></td></tr><tr><td style="width: 290px; padding: 8px; border: 1px solid;"><div>HKEY_PERFORMANCE_DATA</div></td><td style="width: 364px; padding: 8px; border: 1px solid;"><div>HKCC</div></td><td style="width: 381px; padding: 8px; border: 1px solid;"><div>performance information</div></td></tr><tr><td style="width: 290px; padding: 8px; border: 1px solid;"><div>HKEY_CURRENT_CONFIG</div></td><td style="width: 364px; padding: 8px; border: 1px solid;"><div>HKPD</div></td><td style="width: 381px; padding: 8px; border: 1px solid;"><div>some infor on current hw profile</div></td></tr></tbody></table><div>-access registry: regedit.exe</div></div><div><br/></div><div><i>Processes</i></div><div><i>-</i>set of resources used when executing instance of program</div><ol><li><div>private virtual address space (prevent process to access/modify other process/OS data)</div></li><li><div>executable program, mapped to process’s private virtual address space</div></li><li><div>security context (access token): ID of user, security groups, privs, etc.</div></li><li><div>process id</div></li><li><div>one or more threads of execution</div></li></ol><div><br/></div><div><br/></div><div><i>Jobs</i></div><div>-group of processes managed as a unit</div><div>-job: object that controls this group</div><div>-nameable, secured w/ certain constraints </div><div>&gt;i.e. jobs can prevent processes from impersonating other processes or make access tokens for local admin group</div><div><br/></div><div><i>Services</i></div><div>-mechanism to start processes at system startup, not tied to a user </div><div>-unix daemon processes</div><div>-ex: web server, runs whether user is logged in or not</div><div>-each service has registry key in HKLM\SYSTEM\CurrentControlSet\Services</div><div>&gt;sub keys: .exe file path, parameters, and config options, and un if service starts from particular user context</div><div><br/></div><div><i>Service Accounts</i></div><div><i>-</i>services run in the context of user accounts, unless specified, service runs under local system account (SYSTEM or LocalSYSTEM), has highest privs</div><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 267px;"/><col style="width: 473px;"/><col style="width: 604px;"/></colgroup><tbody><tr><td style="background-color: rgb(205, 238, 240); border: 1px solid rgb(137, 215, 220); width: 267px; padding: 8px;"><div>Name</div></td><td style="background-color: rgb(205, 238, 240); border: 1px solid rgb(137, 215, 220); width: 473px; padding: 8px;"><div>Privs</div></td><td style="background-color: rgb(205, 238, 240); border: 1px solid rgb(137, 215, 220); width: 604px; padding: 8px;"><div>Attributes</div></td></tr><tr><td style="width: 267px; padding: 8px; border: 1px solid;"><div>Local System Account</div></td><td style="width: 473px; padding: 8px; border: 1px solid;"><div>can enable all privs, has root</div></td><td style="width: 604px; padding: 8px; border: 1px solid;"><div>other name: SYSTEM</div><div>core windows components run under this</div></td></tr><tr><td style="width: 267px; padding: 8px; border: 1px solid;"><div>Network Service Account</div></td><td style="width: 473px; padding: 8px; border: 1px solid;"><div>some prives, SeImpersonate</div></td><td style="width: 604px; padding: 8px; border: 1px solid;"><div>used for services that auth to network services</div></td></tr><tr><td style="width: 267px; padding: 8px; border: 1px solid;"><div>Local Service Account</div></td><td style="width: 473px; padding: 8px; border: 1px solid;"><div>Same as NSA, but not for auth to network services</div></td><td style="width: 604px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr></tbody></table><div><br/></div></div><div><i>startup programs:</i></div><div>-also called autoruns</div><div>-similar to services, except services are managed by Service Manager </div><div><i><br/></i></div><div><i><br/></i></div><div><span style="font-weight: bold; font-size: 18px;">Methods and Techniques</span></div><div><i><br/></i></div><div><i><br/></i></div><div><i><br/></i></div><div><i><br/></i></div><div><i><br/></i></div><div><i><br/></i></div><div><i><br/></i></div><div><i><br/></i></div><div><i><br/></i></div><div><i><br/></i></div><div><i><br/></i></div><div><i><br/></i></div><div><i><br/></i></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></body></html>